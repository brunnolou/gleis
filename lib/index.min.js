"use strict";function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _defineProperty(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _slicedToArray=function(){function t(t,e){var n=[],i=!0,r=!1,o=void 0;try{for(var s,a=t[Symbol.iterator]();!(i=(s=a.next()).done)&&(n.push(s.value),!e||n.length!==e);i=!0);}catch(t){r=!0,o=t}finally{try{!i&&a.return&&a.return()}finally{if(r)throw o}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),_popmotion=require("popmotion"),_raf=require("raf"),_raf2=_interopRequireDefault(_raf),_springs=require("springs"),_springs2=_interopRequireDefault(_springs),snap=_popmotion.transform.snap,tension=240,friction=20,dragTension=1e3,dragFriction=30,Gleis=function(){function t(e){var n=this,i=e.draggedElement,r=e.wagonElements,o=e.trackElement,s=_slicedToArray(e.bounds,2),a=s[0],u=s[1],p=e.sleepersAt,h=e.reversed,l=void 0!==h&&h,d=e.horizontal,c=void 0===d||d;_classCallCheck(this,t),this.horizontal=c,this.horizontal=c,this.draggedElement=i,this.reversed=l,this.start=a||0,this.end=u||this.getElementSize([o])[0],this.sleepers=p||this.getElementSize(r),this.sleepers=this.setSleepers(this.sleepers),this.snap=snap(this.sleepers),this.mousedownX=0,this.dragStartPositionX=0,this.positionX=0,this.position=0,this.isDragging=!1,this.dragPositionX=this.positionX,this.restX=this.positionX,this.velocityX=0,this.draggedCss=(0,_popmotion.css)(i),o.addEventListener("mousedown",this.onMousedown.bind(this)),o.addEventListener("touchstart",this.onMousedown.bind(this)),this.loop(),this.spring=(0,_springs2.default)(tension,friction,{onInit:function(t){n.Spring=t}})}return _createClass(t,[{key:"setSleepers",value:function(t){var e=[this.start].concat(_toConsumableArray(t),[this.end]);return this.reversed?e.map(function(t){return-1*t}):(e[e.length-1]=this.end-this.getElementSize([this.draggedElement])[0],e)}},{key:"onMousedown",value:function(t){var e=this;this.pointerTracker=(0,_popmotion.pointer)(t).start(),this.xOffset=(0,_popmotion.trackOffset)(this.pointerTracker.x,{from:this.draggedCss.get("x"),onUpdate:function(t){e.position=t}}).start(),this.Spring.setSpringConfig({tension:dragTension,friction:dragFriction}),window.addEventListener("mouseup",this.onMouseup.bind(this)),window.addEventListener("touchend",this.onMouseup.bind(this))}},{key:"onMouseup",value:function(){var t=this.pointerTracker.getVelocity().x/20;this.pointerTracker&&this.pointerTracker.stop(),this.xOffset&&this.xOffset.stop(),this.Spring.setSpringConfig({tension:tension,friction:friction}),this.Spring.setVelocity(t),this.position=this.position+t,this.position=this.snap(this.position),window.removeEventListener("touchend",this.onMouseup.bind(this)),window.removeEventListener("mouseup",this.onMouseup.bind(this))}},{key:"applyForce",value:function(t){this.velocityX+=t}},{key:"getElementSize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=this.horizontal?"width":"height";return[].concat(_toConsumableArray(t)).map(function(t){return t.getBoundingClientRect()[e]})}},{key:"update",value:function(){var t=this.horizontal?"x":"y";this.draggedCss.set(_defineProperty({},t,this.spring(this.position)))}},{key:"loop",value:function(){var t=this;(0,_raf2.default)(function e(){t.update(),(0,_raf2.default)(e)})}},{key:"render",value:function(){var t=document.createElement("div"),e=document.createElement("div"),n=document.createElement("div");t.style="\n      position: fixed;\n      bottom: 40px;\n      right: 40px;\n      width: "+this.end+"px;\n      height: 40px;\n      background: rgba(0,0,0, .1);\n    ";var i="\n      position: absolute;\n      top: -20px;\n      height: 80px;\n      width: 0px;\n      border: 1px solid #333;\n    ";e.style=i,n.style=i,n.style.left=this.end+"px",this.sleepers.forEach(function(e){var n=document.createElement("div");n.style="\n        position: absolute;\n        top: -20px;\n        left: "+e+"px;\n        height: 80px;\n        width: 0px;\n        border: 1px dotted #999;\n      ",t.appendChild(n)}),t.appendChild(e),t.appendChild(n),document.body.appendChild(t)}}]),t}();exports.default=Gleis;